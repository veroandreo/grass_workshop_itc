<!DOCTYPE html>

<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>GRASS GIS crash course at ITC - UTwente</title>
  <meta name="description" content="Short course TGRASS: temporal data processing with GRASS GIS">
  <meta name="author" content="Veronica Andreo, Sajid Pareeth, Paulo van Breugel">
  <link rel="shortcut icon" href="grass.png">

  <script type="text/javascript" src="lib/jquery.js"></script>
  <script type="text/javascript" src="lib/codetabs.js"></script>

<!--
<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
-->

  <script type="text/javascript" src="lib/highlights/highlight.pack.js"></script>
  <link rel="stylesheet" href="lib/highlights/styles/default.css">
  <link rel="stylesheet" href="css/grassdocs.css">
  <link rel="stylesheet" href="css/codetabs.css">

<style type="text/css">
.hljs{
    display: none;
    /*padding: 0em;*/
}
</style>

</head>

<body>

  <div id="container">
<!--
	<a href="https://osgeo.nl/grassgis-course/" title="GRASS Course banner"><img src="https://osgeo.nl/wp-content/uploads/2017/10/GRASSLOGO-1024x115.png" width="112%" height="11" align="center" alt="Banner announcement"></a>  
	<a href="https://www.osgeo.nl/" title="OSGeo-NL"><img src="images/osgeonl-logo-263x70.png" width="25%" height="25%" align="left" alt="OSGeo NL logo"></a>  
-->
    <a href="https://grass.osgeo.org" title="GRASS GIS"><img src="images/grassgis_logo_colorlogo_text_whitebg.png" width="18.5%" height="18.5%" align="right" alt="GRASS GIS logo"></a>
    <a href="https://www.itc.nl/" title="ITC"><img src="images/ITC_UT_logo.png" width="15%" height="15%" align="left" alt="ITC logo"></a>
    <h1 align="center">Hands-on to GIS and RS with GRASS GIS</h1>
    <h2 class="notoc" align="center">ITC - University of Twente</h2>
    <h2 class="notoc" align="center">Enschede, The Netherlands</h2>
    <h3 class="notoc" align="center">November 3rd, 2017</h3>
    <p align="center">
    <a href="https://veroandreo.wordpress.com/" target="_blank">Veronica Andreo</a>, <a href="https://www.un-ihe.org/sajid-pareeth" target="_blank">Sajid Pareeth</a> and <a href="https://pvanb.wordpress.com/" target="_blank">Paulo van Breugel</a>
    </p>
    <p align="center"><a href="https://osgeo.nl/" title="OSGeo-NL"><img src="images/osgeonl-logo-263x70.png" align="center" alt="OSGeo-NL logo"></a></p>
    <p style="border-top-style: solid; border-bottom-style: solid; border-width: 5px; border-color: rgb(130, 130, 130); padding-top: 5px; padding_bottom: 5px;" align="center">
<!--
TODO: add an animation or screenshot
    <a href="#lst-time-series-animation" title="lst time series animation"><img style="width: 25%;" src="figures/animation_nc_zoom.gif" alt="NC to Wake LST animation"></a>
-->
    </p>
    <p>
    Workshop outline:
    <ul>
        <li><a href="#grassgisintro">Introduction to GRASS GIS</a></li>
        <li><a href="#temporalintro">Working with GRASS GIS: Guided exercise</a></li>
        <li><a href="#temporalhands">Choose your own adventure: 3 Hands-on exercises</a></li>
    </ul>
    </p>
    <p>
    Software requirements:
    <ul>
        <li>GRASS GIS 7.2: <a href="https://grass.osgeo.org/download/software/">download</a> | <a href="https://live.osgeo.org/">OSGeo-live</a></li>
<!--
        <li>
            GRASS GIS Add-ons: <a href="https://grass.osgeo.org/grass72/manuals/addons/r.modis.download.html">r.modis.download</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/addons/r.modis.import.html">r.modis.import</a> and
            <a href="https://grass.osgeo.org/grass72/manuals/addons/v.strds.stats.html">v.strds.stats</a>
        </li>
        <li> <a href="http://www.pymodis.org">pyModis</a> library</li>
-->
    </ul>
    </p>
    <p>
    Sample data:
    <ul>
        <li>Main dataset: <a href="https://grass.osgeo.org/sampledata/north_carolina/nc_basic_spm_grass7.tar.gz">North Carolina basic location (50 MB)</a>
        <ul>
            <li>extra "mapset" <a href="https://www.dropbox.com/s/bctjpplr1mathnx/modis_lst.zip?dl=0"><code>modis_lst</code></a>: monthly land surface temperature (LST) from MODIS sensor (MOD11B3.006) for North Carolina (2015-2016)</li>
        </ul>
<!--
        TODO: @Paulo and @Sajid: please add here links to the data you will use (if needed)
-->
    </ul>
    </p>
    <p style="border-top-style: solid; border-width: 5px; border-color: rgb(130, 130, 130); padding-top: 5px;">

    <p>
    <h2><a name="grassgisintro">GRASS GIS introduction</a></h2>

    Working with GRASS GIS is not much different than any other GIS. Just a few commonly used terms need to be introduced first.

    <h3>Basic concepts: GRASS DATABASE, LOCATION and MAPSET</h3>
    
    The <b>GRASS DATABASE</b> (also called "GISDBASE") is an existing directory which contains all GRASS GIS projects. These projects are organized in subdirectories called LOCATIONs.<br>
    A <b>LOCATION</b> is defined by its coordinate system, map projection and geographical boundaries. All data within one Location has the same coordinate reference system.<br>
    <b>MAPSETs</b> are subdirectories within Locations. In a <b>MAPSET</b> you can organize GIS maps thematically, geographically, by project or however you prefer.<br>
    <p>Within each Location, a mandatory <b>PERMANENT</b> Mapset exists. This mapset can contain commonly used data within a Location such as base maps. The PERMANENT Mapset also contains metadata related to the Location it belongs to such as projection. When GRASS GIS is started, it connects to a Database, Location and Mapset specified by the user.</p>
    
    <div class="imagebox">
        <img style="width: 60%;" src="images/grass_database.png" alt="GRASS DATABASE, LOCATIONs, and MAPSETs" title="GRASS DATABASE, LOCATIONs, and MAPSETs"><br>
        GRASS DATABASE, LOCATIONs and MAPSETs
    </div>
	
	<b>Why this structure?</b>
	<ul>
		<li>GRASS has a native format for data, therefore data must be imported or linked into a GRASS LOCATION/MAPSET.</li>
	</ul>
	<b>What are the advantages?</b> 
	<ul>
		<li>GRASS DATABASE, LOCATIONS and MAPSETS are folders that can be easily (zipped and) shared with other users. They just need to (unzip and) move into their GRASS DATABASE (and proper location in case of sharing a mapset).</li>
		<li>The GRASS DATABASE can be local or remote, and special permissions can be set to specific mapsets in a LOCATION (the PERMANENT mapset is accessible from all other mapsets and users).</li> 
		<li>Since all data in a LOCATION have necesarily the same CRS, the usual not-matching map projections problem does not exist.</li>
	</ul>
	Further details can be found at the <a href="https://grass.osgeo.org/grass73/manuals/grass_database.html" target="_blank">GRASS database</a> manual page.
    <h3>Data formats supported</h3>
    GRASS GIS is able to read most raster and vector data formats directly (mainly done through the <a href="http://www.gdal.org/" target="_blank">GDAL</a> library). As mentioned above, GRASS GIS has its own internal formats to manage raster and vector data, so your data have to be imported or linked into a GRASS LOCATION/MAPSET for further processing and analysis.<br><br>
	
    The <b>GRASS GIS vector format is topological</b>, this means that adjacent geographic components in a single vector map are related to each other. For example, in a non-topological GIS if two areas share a common border that border would be digitized twice and also stored in a duplicate manner. In a topological GIS such as GRASS GIS, this border exists only once and it is shared between these two areas. The topological representation of vector data helps to produce and maintain vector maps with clean geometry. Moreover, it enables certain analyses that can not be conducted with non-topological or spaghetti data.<br>
    <div class="imagebox">
        <img style="width: 60%;" src="images/datatypes.png" alt="Vector data types" title="Vector data types"><br>
        All vector data types in GRASS GIS
    </div>
	<h3>Data types in GRASS GIS</h3>
	<ul>
		<li><a href="https://grass.osgeo.org/grass72/manuals/rasterintro.html" target="_blank">Raster</a> (including <a href="https://grass.osgeo.org/grass72/manuals/imageryintro.html" target="_blank">satellite imagery</a>)</li>
		<li><a href="https://grass.osgeo.org/grass72/manuals/raster3dintro.html" target="_blank">3D raster or voxel</a></li>
		<li><a href="https://grass.osgeo.org/grass72/manuals/vectorintro.html" target="_blank">Vector</a>: point, line, boundary, area, face</li>
		<li><a href="https://grass.osgeo.org/grass72/manuals/temporalintro.html" target="_blank">Space-time datasets</a>: collections of raster (<b>STRDS</b>), raster 3D (<b>STR3DS</b>) or vector (<b>STVDS</b>) maps</li>
	</ul>
    <h3>Modules</h3>
    GRASS GIS is composed of more than 450 modules to perform any kind of GIS analysis. It is possible to analize raster, raster 3D, imagery and vector maps along with their alphanumerical attributes.<br>
    The wealth of modules is organized according to their functionality or the data type they take as input. 
    <p>
    <table style="width:80%" border="1" align="center" bgcolor="#FFFFFF">
	   <caption>GRASS GIS module families</caption>
      <tr>
          <th>Prefix</th>
          <th>Function class</th>
          <th>Type of command</th>
          <th>Example</th>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#g" target="_blank">g.*</a></td>
		  <td>general</td>
		  <td>general data management</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/g.rename.html" target="_blank">g.rename</a>: renames map</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#d" target="_blank">d.*</a></td>
		  <td>display</td>
		  <td>graphical output</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/d.rast.html" target="_blank">d.rast</a>: display raster map, d.vect: display vector map</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#r" target="_blank">r.*</a></td>
		  <td>raster</td>
		  <td>raster processing</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/r.mapcalc.html" target="_blank">r.mapcalc</a>: map algebra, r.univar: univariate statistics</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#r" target="_blank">v.*</a></td>
		  <td>vector</td>
		  <td>vector processing</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/v.clean.html" target="_blank">v.clean</a>: topological cleaning</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#i" target="_blank">i.*</a></td>
		  <td>imagery</td>
		  <td>imagery processing</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/i.pca.html" target="_blank">i.pca</a>: Principal Components Analysis on imagery group</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#r3" target="_blank">r3.*</a></td>
		  <td>voxel</td>
		  <td>3D raster processing</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/r3.stats.html" target="_blank">r3.stats</a>: voxel statistics</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#db" target="_blank">db.*</a></td>
		  <td>database</td>
		  <td>database management</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/db.select.html" target="_blank">db.select</a>: select value(s) from table</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#ps" target="_blank">ps.*</a></td>
		  <td>postscript</td>
		  <td>map creation in PostScript format</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/ps.map.html" target="_blank">ps.map</a>: PostScript map creation</td>
      </tr>
      <tr>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/full_index.html#t" target="_blank">t.*</a></td>
		  <td>temporal</td>
		  <td>space-time datasets</td>
		  <td><a href="https://grass.osgeo.org/grass72/manuals/t.rast.aggregate.html" target="_blank">t.rast.aggregate</a>: raster time series aggregation</td>
      </tr>
    </table>
    <p>
	The graphical user interface offers a tree view as well as a search engine.
<!--
	TODO: add screenshot
-->
    <p>
    It is also possible to install further modules, called <b>Add-ons</b>, from a centralized <a href="https://grass.osgeo.org/grass7/manuals/addons/">GRASS GIS Add-on repository</a> at OSGeo or from github using the command <a href="https://grass.osgeo.org/grass72/manuals/g.extension.html">g.extension</a>.
	<pre>
	# install extension from GRASS GIS Add-on repository
	g.extension extension=r.hants
	# install extension from github repository
	g.extension url=https://github.com/pesekon2/GRASS-GIS-SOS-tools/tree/master/sos/r.in.sos
	</pre>
    <h3>Region and Mask</h3>
    The <b>computational (or current) region</b> is the <i>actual setting of the region boundaries and the actual raster resolution</i>.<br>
    The raster input maps are automatically (on the fly) cropped/padded and rescaled to match the current region, the output maps have their bounds and resolution equal to those of the current computational region, while vector maps are always considered completely.
    <div class="imagebox">
        <img style="width: 60%;" src="images/region.png" alt="Show computational region" title="Show computational region"><br>
        The red box shows the computational region currently set
    </div>
    <em>MASK</em>: if a mask is set, raster modules will operate only on data falling inside the masked area(s), i.e. any data falling outside of the mask are treated as if their pixel value were NULL. To set the mask you can use <a href="https://grass.osgeo.org/grass72/manuals/r.mask.html" target="_blank">r.mask</a> or create a raster called <code>MASK</code> (this raster map name is reserved for this purpose).<br>
    <div class="imagebox">
        <img style="width: 60%;" src="images/mask.png" alt="Show MASK effect" title="Show MASK effect"><br>
        By setting the MASK (here based on a ZIP code) only the raster data inside the masked area are used for further analysis
    </div>

    <h3>Interfaces</h3>
    GRASS GIS offers different interfaces for the interaction between user and software. Let's see them...
    <h4>Graphical User Interface</h4>
    The GUI is the simpler way to approach GRASS GIS. The <a href="https://grass.osgeo.org/grass72/manuals/wxGUI.html" target="_blank">GRASS GIS GUI</a> is composed of two elements, the <code>Layer Manager</code> where you can find all the GRASS GIS modules and manage your data and, the <code>Map Display</code> where you can navigate, print and query your maps. The GUI also comes with a Python shell for rapid prototyping.
    <div class="imagebox">
        <img style="width: 90%;" src="images/GUI_description.png" alt="GRASS GIS GUI" title="GRASS GIS GUI"><br>
        GRASS GIS Graphical User Interface (GUI)
    </div>
    Otherwise you can also use GRASS GIS inside QGIS by either using the <code>GRASS GIS plugin</code> or through <code>Processing</code>.
    <h4>Command line</h4>
    The command line is the traditional and, probably, the most powerful way to use GRASS GIS, used daily by many GRASS GIS power users worldwide.
<!--
    TODO: examples, advantages, screenshot
-->
    <h4>Python</h4>
    Python is a powerful and simple programming language, and you can use it to:
    <ul>
        <li>interface with the functionalities offered by GRASS GIS</li>
        <li>create your own workflows chaining several GRASS GIS modules</li>
        <li>create new add-ons by using GRASS GIS modules along with a wide number of Python libraries.</li>
    </ul>
    Here's an example of Python code to run GRASS GIS modules:
    <pre>
		<code class="python">
!/usr/bin/env python

# simple example for pyGRASS usage: raster processing via modules approach

from grass.pygrass.modules.shortcuts import general as g
from grass.pygrass.modules.shortcuts import raster as r

g.message("Filter elevation map by a threshold...")

# set computational region
input = 'elevation'
g.region(rast=input)

# hardcoded:
# r.mapcalc('elev_100m = if(elevation > 100, elevation, null())', overwrite = True)

# with variables
output = 'elev_100m'
thresh = 100.0
r.mapcalc("%s = if(%s > %d, %s, null())" % (output, input, thresh, input), overwrite = True)
r.colors(map=output, color="elevation")
		</code>
    </pre>
    <h4>QGIS</h4>
<!--
    TODO
-->
	<h4>R</h4>
<!--
	TODO
-->
    <h4>WPS - OGC Web Processing Service</h4>
    It is possible to run GRASS GIS modules through the web using the <a href="https://en.wikipedia.org/wiki/Web_Processing_Service" target="_blank">Web Processing Service</a> (WPS is an <a href="https://en.wikipedia.org/wiki/Open_Geospatial_Consortium" target="_blank">OGC</a> standard). The Free and Open Source software <a href="http://zoo-project.org/" target="_blank">ZOO-Project</a> and <a href="http://pywps.org/" target="_blank">PyWPS</a> allow the user to run GRASS GIS commands in a simple way.
	
<!--
    <h2><a name="temporalintro">Temporal GRASS GIS introduction</a></h2>

    <p>
	GRASS GIS is the first Open Source GIS that incorporated capabilities to manage, analyze, process and visualize spatio-temporal data, as well as the temporal relationships among time series.
    <p>
    Importantly, the <b>TGRASS</b> concept is based on metadata and does not duplicate any datasets. It follows a <i>snapshot</i> approach, i.e.: add time stamps to existent maps, to integrate time dimension to the classical spatial GIS. In GRASS GIS words, all pixels in a raster map and all elements in a vector map, share the same time stamp. A collection of time stamped maps (snapshots) of the same variable are called <b>space-time datasets (STDS)</b> in TGRASS. Each map in a STDS might have a different spatial and temporal extent.
    <p>
    TGRASS uses an SQL database to store the temporal and spatial extension of STDS, as well as the topological relationships among maps and among STDS.

    <h3>Terminology overview</h3>
    <h4>Temporal database</h4>
    A temporal database is a mapset-specific database in which all time stamped maps are registered, i.e.: their spatial and temporal extents, unique ID and map type metadata are stored.
    This allows users to perform complex SQL queries using the spatio-temporal extent and metadata information for map selection (See <a href=#temporal_analysis>Temporal data analysis</a> section).
    <h4>Space-time datasets</h4>
    Space-time datasets are called differently according to the map type they are formed of:
    <ul>
        <li>Space time raster datasets (<b>STRDS</b>) collections of time stamped raster maps.</li>
        <li>Space time 3D raster datasets (<b>STR3DS</b>) collections of time stamped 3D raster maps.</li>
        <li>Space time vector datasets (<b>STVDS</b>) collections of time stamped vector maps.</li>
    </ul>
	<h4>Spatio-temporal modules</h4>
	<ul>
		<li><b>t.*</b>: General modules to handle STDS of all types</li>
		<li><b>t.rast.*</b>: Modules that specifically deal with STRDS</li>
		<li><b>t.rast3d.*</b>: Modules that specifically deal with STR3DS</li>
		<li><b>t.vect.*</b>: Modules that specifically deal with STVDS</li>
	</ul>
    <h4>Absolute time vs relative time</h4>
    <p>
    Two different time definitions are used in TGRASS:
    <table style="width:60%" border="1" align="center" bgcolor="#FFFFFF">
      <tr>
        <th>Absolute time</th>
        <th>Relative time</th>
      </tr>
      <tr>
        <td>Gregorian calendar (ISO 8601 time format notation)</td>
        <td>An integer and a time unit (year, month, day, hour, minute, seconds)</td>
      </tr>
      <tr>
        <td>Example: 2013-10-15 13:00:00</td>
        <td>Example: 4 years, 90 days, 1 second</td>
      </tr>
    </table>
    <h4>Time intervals vs time instances</h4>
    <p>
    GRASS GIS supports both time intervals and time instances as map time stamps:
    <p>
    <table style="width:60%" border="1" align="center" bgcolor="#FFFFFF">
      <tr>
          <th>Time intervals</th>
          <th>Time instances</th>
      </tr>
      <tr>
          <td>Defined by start time and end time: [start, end)</td>
          <td>Defined by start time</td>
      </tr>
      <tr>
          <td>Support for gaps, allow overlapping, might contain time instances, might be irregularly spaced in time</td>
          <td>Punctual events</td>
      </tr>
    </table>
    <h4>Granularity</h4>
    <p>
    The granularity is the largest common divider granule of time intervals and gaps between intervals or instances from all time stamped maps that are collected in a STDS. It is represented as a number of seconds, minutes, hours, days, weeks, months or years.

    <h3>Workflow overview</h3>
    Now, how do we work with time series in GRASS GIS? Where do we start? Well, assuming we already have our maps in the GRASSDBASE, the first step is to set the connection to the temporal database. This is something we will need to do only once per mapset. After that, we create the STDSs, i.e.: the containers for the time series, and finally we assign time stamps to maps and register them in the STDS. After these basic steps, the following will depend on our specific objectives.
    <ol>
        <li>Set and connect the temporal database (mapset specific): <a href="https://grass.osgeo.org/grass72/manuals/t.connect.html" target="_blank">t.connect</a></li>
        <li>Create the STDS (raster, vector or raster 3D): <a href="https://grass.osgeo.org/grass72/manuals/t.create.html" target="_blank">t.create</a></li>
        <li>Assign time stamps to maps and register them in the STDS: <a href="https://grass.osgeo.org/grass72/manuals/t.register.html" target="_blank">t.register</a></li>
        <li>
            Check basic info, integrity and validity of STDS: <a href="https://grass.osgeo.org/grass72/manuals/t.list.html" target="_blank">t.list</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.info.html" target="_blank">t.info</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.topology.html" target="_blank">t.topology</a>
        </li>
        <li>
            Edit, update, unregister, remove maps and/or STDS: <a href="https://grass.osgeo.org/grass72/manuals/t.rename.html" target="_blank">t.rename</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.remove.html" target="_blank">t.remove</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.support.html" target="_blank">t.support</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.unregister.html" target="_blank">t.unregister</a>
        </li>
        <li>
            List maps, make selections, get univariate statistics:
            <a href="https://grass.osgeo.org/grass72/manuals/t.rast.list.html" target="_blank">t.rast.list</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.vect.list.html" target="_blank">t.vect.list</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.select.html" target="_blank">t.select</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.rast.extract.html" target="_blank">t.rast.extract</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.vect.extract.html" target="_blank">t.vect.extract</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.rast.univar.html" target="_blank">t.rast.univar</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/t.vect.univar.html" target="_blank">t.vect.univar</a>
        </li>
        <li>Spatio-temporal processing (a bit raster biased):
            <ul>
                <li>
                    data aggregation: <a href="https://grass.osgeo.org/grass72/manuals/t.rast.series.html" target="_blank">t.rast.series</a>,
                    <a href="https://grass.osgeo.org/grass72/manuals/t.rast.aggregate.html" target="_blank">t.rast.aggregate</a>,
                    <a href="https://grass.osgeo.org/grass72/manuals/t.rast.aggregate.ds.html" target="_blank">t.rast.aggregate.ds</a>
                </li>
                <li>
                    data accumulation: <a href="https://grass.osgeo.org/grass72/manuals/t.rast.accumulate.html" target="_blank">t.rast.accumulate</a>,
                    <a href="https://grass.osgeo.org/grass72/manuals/t.rast.accumulate.html" target="_blank">t.rast.accumulate</a>,
                </li>
                <li>
                    gap-filling and smoothing: <a href="https://grass.osgeo.org/grass72/manuals/t.rast.gapfill.html" target="_blank">t.rast.gapfill</a>,
                    <a href="https://grass.osgeo.org/grass72/manuals/t.rast.neighbors.html" target="_blank">t.rast.neighbors</a>
                </li>
                <li>
                    spatio-temporal algebra: <a href="https://grass.osgeo.org/grass72/manuals/t.rast.mapcalc.html" target="_blank">t.rast.mapcalc</a>,
                    <a href="https://grass.osgeo.org/grass72/manuals/t.rast.algebra.html" target="_blank">t.rast.algebra</a>,
                    <a href="https://grass.osgeo.org/grass72/manuals/t.vect.algebra.html" target="_blank">t.vect.algebra</a>
                </li>
            </ul>
        </li>
        <li>
            Visualization: <a href="https://grass.osgeo.org/grass72/manuals/g.gui.timeline.html" target="_blank">g.gui.timeline</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/g.gui.tplot.html" target="_blank">g.gui.tplot</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/g.gui.animation.html" target="_blank">g.gui.animation</a>,
            <a href="https://grass.osgeo.org/grass72/manuals/g.gui.mapswipe.html" target="_blank">g.gui.mapswipe</a>
        </li>
    </ol>

    <h2><a id="temporalhands">Hands-on to raster time series processing</a></h2>
    <h3>Getting the MODIS satellite sensor data</h3>
    MODIS is a payload scientific instrument on board the NASA Terra and the Aqua satellites with 36 spectral bands. Data are available for download upon <a href="https://urs.earthdata.nasa.gov/users/new" target="_blank">user registration</a>.
    <p>
    Create the <i>SETTING</i> file with the following content, e.g. in the directory <tt>$HOME/gisdata/</tt>:<br>
    <tt>
your_NASA_user<br>
your_NASA_password
    </tt>
    </p>
    <p>
    The <a href="https://grass.osgeo.org/grass72/manuals/addons/r.modis.download.html" target="_blank">r.modis.download</a> directly downloads from the MODIS data server into a local folder previously created (for example: <tt>lst_modis</tt>):
    <pre>
        <code class="neutral">
r.modis.download -g settings=$HOME/gisdata/SETTING product=lst_terra_monthly_5600 tiles=h11v05 startday="2015-01-01" endday="2016-12-31" folder=$HOME/lst_monthly
r.modis.import -w files=$HOME/lst_monthly/listfileMOD11B3.006.txt spectral="( 1 )" outfile=$HOME/lst_monthly/monthly_lst_to_register.txt
g.list type=raster pattern="MOD11B3*"
        </code>
        <code class="bash">
# Create folder to store .hdf files
mkdir $HOME/lst_monthly

# Download data: MOD11B3 2015-2016, tile h11v05
r.modis.download -g settings=$HOME/gisdata/SETTING \
 product=lst_terra_monthly_5600 \
 tiles=h11v05 startday="2015-01-01" endday="2016-12-31" \
 folder=$HOME/lst_monthly

# Reproject from Sinusoidal to current NC projection and import maps into NC Location (Day and Night overpasses)
r.modis.import -w files=$HOME/lst_monthly/listfileMOD11B3.006.txt \
 spectral="( 1 )" \
 outfile=$HOME/lst_monthly/monthly_lst_to_register.txt

# Check list of imported maps
g.list type=raster pattern="MOD11B3*"
        </code>
        <code class="python">
# Import the needed libraries
import grass.pygrass.modules as gmod
import os
from subprocess import PIPE

# Set variables
# home
HOME=os.path.expanduser('~')

# Create folder to store .hdf files
os.makedirs(os.path.join(HOME, lst_monthly))

# Download data: MOD11B3 2015-2016, tile h11v05
gmod.Module("r.modis.download", flags="g", settings=os.path.join(HOME, 'gisdata', 'SETTING'),
 product="lst_terra_monthly_5600", tiles="h11v05", startday="2015-01-01",
 endday="2016-12-31", folder=os.path.join(HOME, lst_monthly)

# Reproject and import maps into NC Location (Day and Night)
gmod.Module("r.modis.import", flags="w", files=os.path.join(HOME, 'lst_monthly', 'listfileMOD11B3.006.txt'),
 spectral="( 1 )", outfile=os.path.join(HOME, 'lst_monthly', 'monthly_lst_to_register.txt'))

# Check list of imported maps
glist = gmod.Module("g.list", type="raster", pattern="MOD11B3*", stdout_=PIPE, stderr_=PIPE)
print(glist.outputs["stdout"].value)
        </code>
    </pre>
    <p>We will now visualize one of the MODIS LST images and add different map decorations. We first change the color palette from <i>grey</i> to <i>viridis</i> and set the computational region to the state of North Carolina (using <tt>boundary_state</tt> vector map).</p>
    <p>
    <pre>
        <code class="neutral">
r.colors MOD11B3.A2015060.h11v05.single_LST_Day_6km color=viridis
g.region -p vector=boundary_state
        </code>
        <code class="bash">
# Change color palette from grey to viridis
r.colors MOD11B3.A2015060.h11v05.single_LST_Day_6km color=viridis

# Set region to NC (g.region -d)
g.region -p vector=boundary_state

# Optionally, to the full extent of one of the raster maps
g.region -p raster=MOD11B3.A2015060.h11v05.single_LST_Day_6km
        </code>
        <code class="python">
# Change color palette from grey to viridis
gmod.Module("r.colors", map="MOD11B3.A2015060.h11v05.single_LST_Day_6km", color="viridis")

# Set region to NC
gmod.Module("g.region", flags="p", vector="boundary_state")

# Optionally, to the full extent of one of the raster maps
gmod.Module("g.region", flags="p", raster="MOD11B3.A2015060.h11v05.single_LST_Day_6km")
        </code>
    </pre>
    <p>We can open a monitor and run the commands from the command line or do everything in the main GUI and copy the commands for future reference or replication. Note the <i>Copy</i> button in each command GUI.</p>
    <pre>
        <code class="neutral">
# Open a monitor
d.mon wx0

# Display raster map
d.rast map=MOD11B3.A2015060.h11v05.single_LST_Day_6km

# Display vector map
d.vect map=boundary_state type=boundary

# Add raster legend
d.legend -t -s -b raster=MOD11B3.A2015060.h11v05.single_LST_Day_6km \
 title=LST title_fontsize=20 font=sans fontsize=18

# Add scale bar
d.barscale length=200 units=kilometers segment=4 fontsize=14

# Add North arrow
d.northarrow style=1b text_color=black

# Add text
d.text -b text="LST Day from MOD11B3.006 - North Carolina - March, 2015" \
 color=black bgcolor=229:229:229 align=cc font=sans size=8
        </code>
        <code class="gui">
        <video controls>
			<source src="figures/gui_display_map.ogg" type="video/ogg">
		</video>
		</code>
    </pre>
    <p style="text-align:center">
    <div class="imagebox">
        <img style="width: 70%;" src="figures/mod11b3_nc.png" alt="display LST map with decorations" title="display LST map with decorations"><br>
        MODIS LST map with decorations (scaled Kelvin pixel values)
    </div>
    </p>

    <h3>Create temporal raster dataset (STRDS)</h3>
    <p>
    To create a space-time raster data set (STRDS) implies to create an SQLite table in the temporal database, i.e.: a container table, that will hold our raster time series and will allow us to easily handle huge amounts of maps by only using the STRDS as input in temporal commands.
    <p>
    If this is the first time you use the temporal framework, you need to create and set the connection to the temporal database by means of <a href="https://grass.osgeo.org/grass72/manuals/t.connect.html" target="_blank">t.connect</a>. As the temporal database is mapset specific, you'll need to repeat this step in each mapset in which you'll have STDSs.
    <p>
    Once the connection is set, you can create the empty STRDS, i.e.: the empty table, in which you'll put (aka: register) all your time series maps afterwards. For the creation of any STDS, we need to specify which <b>type of maps</b> (raster, raster3d or vector) the STDS will contain and which <b>type of time</b> (absolute or relative) the maps represent.
    <pre>
        <code class="neutral">
t.connect -d
t.create type=strds temporaltype=absolute output=LST_Day_monthly title="Monthly LST Day 5.6 km" description="Monthly LST Day 5.6 km MOD11B3.006, 2015-2016"
t.list type=strds
t.info input=LST_Day_monthly
        </code>
        <code class="bash">
# Create the temporal db connection
t.connect -d

# Create the STRDS
t.create type=strds temporaltype=absolute output=LST_Day_monthly \
 title="Monthly LST Day 5.6 km" \
 description="Monthly LST Day 5.6 km MOD11B3.006, 2015-2016"

# Check if the STRDS is created
t.list type=strds

# Get info about the STRDS
t.info input=LST_Day_monthly
        </code>
        <code class="python">
import grass.temporal as tgis

# Create the temporal db connection using temporal library
gmod.Module("t.connect", flags="d")

# Initialize the temporal library
tgis.init()

# Create the new STRDS
tgis.open_new_stds("LST_Day_monthly", "strds", "absolute", "Monthly LST Day 5.6 km",
                   "Monthly LST Day 5.6 km MOD11B3.006, 2015-2016", "mean", None, False)
# Connect to the SQL database interface
dbif = tgis.SQLDatabaseInterfaceConnection()
dbif.connect()

# Get and print the list of temporal dataset
stds_list = tgis.get_dataset_list("strds", "absolute", dbif=dbif)
print(stds_list)

# Get and print info about the created strds
dataset = tgis.dataset_factory("strds", "LST_Day_monthly@modis_lst")
dataset.select(dbif)
dataset.print_info()
        </code>
    </pre>
    <p>Once the STRDS is created, we assign time stamps to maps and add them to the STRDS, i.e.: we <i>register</i> maps in the STRDS. To register maps in a STDS, we need to pass the empty STDS as input and the list of maps to be registered. There are different ways to register maps in STDS. For more options, you can check the <a href="https://grass.osgeo.org/grass72/manuals/t.register.html" target="_blank">t.register</a> manual and the related <a href="https://grasswiki.osgeo.org/wiki/Temporal_data_processing/maps_registration" target="_blank">wiki</a> page.</p>
    <pre>
        <code class="neutral">
t.register input=LST_Day_monthly file=$HOME/lst_monthly/monthly_lst_to_register.txt
        </code>
        <code class="bash">
# Register maps in STRDS
t.register input=LST_Day_monthly \
 file=$HOME/lst_monthly/monthly_lst_to_tregister.txt
        </code>
        <code class="python">
# Register maps using the Python function
gmod.Module("t.register", input="LST_Day_monthly@modis_lst",
            file=os.path.join(HOME, 'lst_monthly', 'monthly_lst_to_register.txt'))
        </code>
    </pre>
    <p>Alternatively, we could have registered our raster maps using the <tt>maps</tt>, <tt>start</tt> and <tt>increment</tt> options along with the <tt>i</tt> flag for interval creation. The command in that case would look as follows:</p>
    <pre>
        <code class="neutral">
t.register -i input=LST_Day_monthly \
 maps=`g.list type=raster pattern=MOD11B3*LST_Day* separator=comma` \
 start="2015-01-01" increment="1 months"
        </code>
    </pre>
    <p>Let's check now the basic info again to see how it looks like and list the raster maps in our <tt>LST_Day_monthly</tt> STRDS:</p>
    <pre>
        <code class="neutral">
t.info LST_Day_monthly
t.rast.list LST_Day_monthly
        </code>
        <code class="bash">
# Check info
t.info LST_Day_monthly

# Check the list of maps in the STRDS
t.rast.list LST_Day_monthly
        </code>
        <code class="python">
# Get info using the modules
gmod.Module("t.info", input="LST_Day_monthly")

# Get list of raster using the Python library
tgis.list_maps_of_stds("strds", "LST_Day_monthly@modis_lst", "name,mapset,start_time,end_time",
                       "start_time", "", "|", "cols", True, "no")
        </code>
    </pre>
    <p>Let's see our STRDS graphically. We will use the <a href="https://grass.osgeo.org/grass72/manuals/g.gui.timeline.html" target="_blank">g.gui.timeline</a> tool.</p>
    <pre>
        <code class="neutral">
g.gui.timeline inputs=LST_Day_monthly
        </code>
        <code class="gui">
The tool g.gui.timeline is under the <em>Temporal</em> menu, in <em>GUI Tools</em> section. It can also be called from the terminal with: <tt>g.gui.timeline --ui</tt>.

To plot a STDS:
1. Choose a STRDS from the dropdown list.
2. Click the <em>Draw</em> button.
3. Change the margin settings as desired.

Alternatively, you can also get a 3D representation of the STDS (i.e.: x, y and time) by checking the 3D box.
<div class="imagebox">
<img style="width: 80%;" src="figures/workflow_g_gui_timeline.png" alt="Workflow for plotting STRDS with g.gui.timeline" title="Workflow for plotting STRDS with g.gui.timeline"><br>
Workflow for plotting STRDS with g.gui.timeline
</div>
		</code>
    </pre>
    <div class="imagebox">
        <img style="width: 60%;" src="figures/g_gui_timeline_lst_monthly.png" alt="Timeline plot" title="Timeline plot for LST_Day_monthly time series"><br>
        Timeline plot for LST_Day_monthly time series
    </div>

    <h3><a name="temporal_analysis" >Temporal data analysis</a></h3>
    <p>
	One basic but very important function when handling hundreds or thousands of maps is the listing function, i.e.: we usually need to list maps that meet a certain condition. For example, we need maps which start month is June, maps with minimum values lower than 100, and so on. The GRASS GIS Temporal framework has different commands for that task: <a href="https://grass.osgeo.org/grass72/manuals/t.list.html" target="_blank">t.list</a> for listing STDS and maps registered in the temporal database, <a href="https://grass.osgeo.org/grass72/manuals/t.rast.list.html" target="_blank">t.rast.list</a> for maps in raster time series and, <a href="https://grass.osgeo.org/grass72/manuals/t.vect.list.html" target="_blank">t.vect.list</a> for maps in vector time series. All these commands allow us to list STDSs and/or maps according to different criteria. Let's see some examples with our <tt>LST_Day_monthly</tt> STRDS:</p>
    <pre>
        <code class="neutral">
# Maps with minimum value lower than or equal to 14000
t.rast.list input=LST_Day_monthly order=min columns=name,start_time,min where="min <= '14000'"

name|start_time|min
MOD11B3.A2015032.h11v05.single_LST_Day_6km|2015-02-01 00:00:00|12950.0
MOD11B3.A2016032.h11v05.single_LST_Day_6km|2016-02-01 00:00:00|12964.0
MOD11B3.A2015001.h11v05.single_LST_Day_6km|2015-01-01 00:00:00|13022.0

# Maps with maximum value higher than 14000
t.rast.list input=LST_Day_monthly order=max columns=name,start_time,max where="max > '14000'"

name|start_time|max
MOD11B3.A2016001.h11v05.single_LST_Day_6km|2016-01-01 00:00:00|14360.0
MOD11B3.A2015001.h11v05.single_LST_Day_6km|2015-01-01 00:00:00|14396.0
MOD11B3.A2015032.h11v05.single_LST_Day_6km|2015-02-01 00:00:00|14522.0

# Maps between two given dates
t.rast.list input=LST_Day_monthly columns=name,start_time where="start_time >= '2015-05' and start_time <= '2015-08-01 00:00:00'"

name|start_time
MOD11B3.A2015121.h11v05.single_LST_Day_6km|2015-05-01 00:00:00
MOD11B3.A2015152.h11v05.single_LST_Day_6km|2015-06-01 00:00:00
MOD11B3.A2015182.h11v05.single_LST_Day_6km|2015-07-01 00:00:00
MOD11B3.A2015213.h11v05.single_LST_Day_6km|2015-08-01 00:00:00

# Maps from January
t.rast.list input=LST_Day_monthly columns=name,start_time where="strftime('%m', start_time)='01'"

name|start_time
MOD11B3.A2015001.h11v05.single_LST_Day_6km|2015-01-01 00:00:00
MOD11B3.A2016001.h11v05.single_LST_Day_6km|2016-01-01 00:00:00

# Maps from June, 1st
t.rast.list input=LST_Day_monthly columns=name,start_time where="strftime('%m-%d', start_time)='06-01'"

name|start_time
MOD11B3.A2015152.h11v05.single_LST_Day_6km|2015-06-01 00:00:00
MOD11B3.A2016153.h11v05.single_LST_Day_6km|2016-06-01 00:00:00
        </code>
    </pre>
    <p>
	To explore a bit more our time series, we will obtain univariate statistics for the maps in the STRDS. There's a dedicated module for that: <a href="https://grass.osgeo.org/grass72/manuals/t.rast.univar.html" target="_blank">t.rast.univar</a>. There's also the possibility to obtain extended statistics such as first quartile, median value, third quartile and percentile 90 by setting the <tt>e</tt> flag. Let's see:</p>
    <pre>
        <code class="neutral">
t.rast.univar input=LST_Day_monthly

id|start|end|mean|min|max|mean_of_abs|stddev|variance|coeff_var|sum|null_cells|cells
MOD11B3.A2015001.h11v05.single_LST_Day_6km@modis_lst|2015-01-01 00:00:00|2015-02-01 00:00:00|13920.4954589617|13022|14396|13920.4954589617|204.922713367766|41993.3184540075|1.47209353267553|329539889|51297|74970
MOD11B3.A2015032.h11v05.single_LST_Day_6km@modis_lst|2015-02-01 00:00:00|2015-03-01 00:00:00|13850.5832593907|12950|14522|13850.5832593907|269.511406162359|72636.3980516119|1.94584878567933|327801754|51303|74970
MOD11B3.A2015060.h11v05.single_LST_Day_6km@modis_lst|2015-03-01 00:00:00|2015-04-01 00:00:00|14387.8026526992|13771|14913|14387.8026526992|202.223782537869|40894.4582239235|1.40552235403321|340616840|51296|74970
MOD11B3.A2015091.h11v05.single_LST_Day_6km@modis_lst|2015-04-01 00:00:00|2015-05-01 00:00:00|14724.7657768016|14160|15212|14724.7657768016|127.152673621415|16167.8024090742|0.863529346060911|348594105|51296|74970

t.rast.univar -e input=LST_Day_monthly

id|start|end|mean|min|max|mean_of_abs|stddev|variance|coeff_var|sum|null_cells|cells|first_quartile|median|third_quartile|percentile_90
MOD11B3.A2015001.h11v05.single_LST_Day_6km@modis_lst|2015-01-01 00:00:00|2015-02-01 00:00:00|14063.8152535675|13625|14289|14063.8152535675|104.326695294161|10884.0593510007|0.741809341300163|12313517190|135054|1010600|14001|14076|14148|14183
MOD11B3.A2015032.h11v05.single_LST_Day_6km@modis_lst|2015-02-01 00:00:00|2015-03-01 00:00:00|14040.1111911881|13532|14349|14040.1111911881|128.052778812874|16397.5141616988|0.912049606083195|12292763193|135054|1010600|13944|14059|14140|14190
MOD11B3.A2015060.h11v05.single_LST_Day_6km@modis_lst|2015-03-01 00:00:00|2015-04-01 00:00:00|14509.6026765013|14012|14884|14509.6026765013|128.58386990137|16533.8115988123|0.886198421612294|12703824585|135054|1010600|14417|14523|14599|14664
MOD11B3.A2015091.h11v05.single_LST_Day_6km@modis_lst|2015-04-01 00:00:00|2015-05-01 00:00:00|14781.4240850852|14160|15128|14781.4240850852|116.594077815457|13594.1789816369|0.788787853892261|12941816732|135054|1010600|14724|14802|14859|14907

t.rast.univar input=LST_Day_monthly separator=comma output=stats_LST_Day_monthly.csv
        </code>
        <code class="bash">
# Print univariate stats for maps within STRDS
t.rast.univar input=LST_Day_monthly

# Get extended statistics
t.rast.univar -e input=LST_Day_monthly

# Write the univariate stats output to a csv file
t.rast.univar input=LST_Day_monthly separator=comma output=stats_LST_Day_monthly.csv
        </code>
        <code class="python">
# Print univarite statistics with the Python library
tgis.print_gridded_dataset_univar_statistics("strds", "LST_Day_monthly@modis_lst", None, None, False, False, ",", False)

# Print extended univarite statistics with the Python library
tgis.print_gridded_dataset_univar_statistics("strds", "LST_Day_monthly@modis_lst", None, None, True, False, ",", False)

<!-- TODO this doesn't work for me
# Write the univariate stats output to a csv file
tgis.print_gridded_dataset_univar_statistics("strds", "LST_Day_monthly@modis_lst", 'stats_LST_Day_monthly.csv', None, False, False, ",", False)
-->
<!--
        </code>
    </pre>
    <p>However, those statistics are a bit difficult to directly interpret since values are in &deg;K*50. Let's re-scale the data to &deg;C and run the previous command again. Then, we will set a proper color palette for the STRDS and display one map. The latter, you already know how to do.</p>
    <p>To transform all the maps in our <tt>LST_Day_monthly</tt> time series into &deg;C we will use the <a href="https://grass.osgeo.org/grass72/manuals/t.rast.algebra.html" target="_blank">t.rast.algebra</a> module. This module allows us to perform a very wide variety of operations in the temporal and spatial domains, as well as much of the more <i>"classical"</i> operations already available in <a href="https://grass.osgeo.org/grass72/manuals/r.mapcalc.html" target="_blank">r.mapcalc</a>.</p>
    <pre>
        <code class="neutral">
t.rast.algebra basename=LST_Day_monthly_celsius expression="LST_Day_monthly_celsius = LST_Day_monthly * 0.02 - 273.15"
t.rast.univar input=LST_Day_monthly_celsius
t.rast.colors input=LST_Day_monthly_celsius color=celsius
        </code>
        <code class="bash">
# Re-scale data into degrees Celsius
t.rast.algebra basename=LST_Day_monthly_celsius \
 expression="LST_Day_monthly_celsius = LST_Day_monthly * 0.02 - 273.15"

# Print univariate stats
t.rast.univar input=LST_Day_monthly_celsius

# Set a dedicated color pallete
t.rast.colors input=LST_Day_monthly_celsius color=celsius
        </code>
        <code class="python">
# Re-scale data into degrees Celsius
gmod.Module("t.rast.algebra", basename="LST_Day_monthly_celsius",
             expression="LST_Day_monthly_celsius = LST_Day_monthly * 0.02 - 273.15")

# Print univarite statistics with the Python library
tgis.print_gridded_dataset_univar_statistics("strds", "LST_Day_monthly_celsius@modis_lst", None, None, False, False, ",", False)
gmod.Module("t.rast.colors", input="LST_Day_monthly_celsius", color="celsius")
        </code>
    </pre>
    <div class="imagebox">
        <img style="width: 70%;" src="figures/lst_modis_celsius.png" alt="LST MODIS in degrees Celsius" title="LST MODIS in degrees Celsius"><br>
        MODIS LST re-scaled to degrees Celsius
    </div>
    <p>Alternatively, we could have used <a href="https://grass.osgeo.org/grass72/manuals/t.rast.mapcalc.html" target="_blank">t.rast.mapcalc</a> to perform the previous transformation. The command would look like this:</p>
    <pre>
        <code class="neutral">
t.rast.mapcalc input=LST_Day_monthly output=LST_Day_monthly_celsius basename=LST_Day_monthly_celsius expression="LST_Day_monthly * 0.02 - 273.15"
		</code>
	</pre>

    <h3>Temporal aggregations</h3>
    <p>There are basically two dedicated modules to perform temporal aggregations in GRASS GIS. The first one that we will use is <a href="https://grass.osgeo.org/grass72/manuals/t.rast.series.html" target="_blank">t.rast.series</a>. This module is a wrapper for <a href="https://grass.osgeo.org/grass72/manuals/r.series.html" target="_blank">r.series</a> and allows us to aggregate our STRDS or parts of it with different methods. We will use it now to obtain the absolute maximum LST in the past two years.</p>
    <pre>
        <code class="neutral">
t.rast.series input=LST_Day_monthly_celsius output=LST_Day_max method=maximum
r.colors map=LST_Day_max color=celsius
d.mon wx0
d.rast LST_Day_max
d.vect map=boundary_state type=boundary
d.legend -t -s -b raster=LST_Day_max title=LST title_fontsize=20 font=sans fontsize=18
d.barscale length=200 units=kilometers segment=4 fontsize=14
d.northarrow style=1b text_color=black
d.text -b text="Maximum LST in the period 2015-2016 - North Carolina" color=black bgcolor=229:229:229 align=cc font=sans size=8
        </code>
        <code class="bash">
# Get maximum LST in the STRDS
t.rast.series input=LST_Day_monthly_celsius \
 output=LST_Day_max method=maximum

# Change color pallete to celsius
r.colors map=LST_Day_max color=celsius

# Display the new map
d.mon wx0
d.rast LST_Day_max
d.vect map=boundary_state type=boundary
d.legend -t -s -b raster=LST_Day_max \
 title=LST title_fontsize=20 font=sans fontsize=18
d.barscale length=200 units=kilometers segment=4 fontsize=14
d.northarrow style=1b text_color=black
d.text -b text="Maximum LST in the period 2015-2016 - North Carolina" \
 color=black bgcolor=229:229:229 align=cc font=sans size=8
        </code>
        <code class="python">
# Get maximum LST in the STRDS
gmod.Module("t.rast.series", input="LST_Day_monthly_celsius",
            output="LST_Day_max", method="maximum")

# Change color pallete to celsius
gmod.Module("r.colors", map="LST_Day_max", color="celsius")
        </code>
    </pre>
    <div class="imagebox">
        <img style="width: 70%;" src="figures/max_lst.png" alt="Maximum LST 2015-2016" title="Maximum LST 2015-2016"><br>
        Maximum LST in the period 2015-2016 in North Carolina
    </div>
    </pre>
    <p>Now, by means of the spatio-temporal map calculator, we will get the month in which the absolute maximum LST occurred. For that, we will first compare our <tt>LST_Day_monthly_celsius</tt> STRDS with the map of absolute maximum LST <tt>LST_Day_max</tt> that we just obtained before. If they coincide, we keep the month for that pixel, otherwise it will be NULL. Then, we aggregate the resulting <tt>month_max_lst</tt> STRDS with <tt>t.rast.series method=maximum</tt> and we get the map with the pixelwise month in which the absolute maximum LST has occurred in the past two years. Finally, we remove the intermediate STRDS, since we are only interested in the aggregated map.</p>
    <pre>
        <code class="neutral">
t.rast.mapcalc -n inputs=LST_Day_monthly_celsius output=month_max_lst expression="if(LST_Day_monthly_celsius == LST_Day_max, start_month(), null())" basename=month_max_lst
t.rast.series input=month_max_lst method=maximum output=max_lst_date
t.remove -rf inputs=month_max_lst
        </code>
        <code class="bash">
# New strds with month of overall maximum
t.rast.mapcalc -n inputs=LST_Day_monthly_celsius output=month_max_lst \
 expression="if(LST_Day_monthly_celsius == LST_Day_max, start_month(), null())" \
 basename=month_max_lst

# Get basic info
t.info month_max_lst

# Map with month of overall maximum
t.rast.series input=month_max_lst method=maximum output=max_lst_date

# Remove month_max_lst strds (we were only interested in the resulting aggregated map)
t.remove -rf inputs=month_max_lst
        </code>
        <code class="python">
# New strds with month of overall maximum
gmod.Module("t.rast.mapcalc", flags="n", inputs="LST_Day_monthly_celsius", output="month_max_lst",
            expression="if(LST_Day_monthly_celsius == LST_Day_max, start_month(), null())",
            basename="month_max_lst")

# Map with month of overall maximum
gmod.Module("t.rast.series", input="month_max_lst", method="maximum", output="max_lst_date")

# Remove month_max_lst strds
gmod.Module("t.remove", flags="rf", inputs="month_max_lst")
        </code>
    </pre>
    <p>Note that the flags <tt>"-rf"</tt> force (immediate) removal of both the STRDS (i.e.: the container table) and the maps registered in it.</p>
    <p>Finally, we display the resulting map:</p>
    <pre>
        <code class="neutral">
d.mon wx0
d.rast max_lst_date
d.vect map=boundary_state type=boundary
d.legend -t -s -b raster=max_lst_date title=LST title_fontsize=20 font=sans fontsize=18
d.barscale length=200 units=kilometers segment=4 fontsize=14
d.northarrow style=1b text_color=black
d.text -b text="Month of maximum LST 2015-2016" color=black bgcolor=229:229:229 align=cc font=sans size=8
        </code>
    </pre>
    <div class="imagebox">
        <img style="width: 70%;" src="figures/month_max_lst.png" alt="Month of maximum LST" title="Month of maximum LST"><br>
        Month of maximum LST for the period 2015-2016
    </div>
    <p>The other module that allows us to perform temporal aggregations is <a href="https://grass.osgeo.org/grass72/manuals/t.rast.aggregate.html" target="_blank">t.rast.aggregate</a>. With this module we are able to aggregate raster maps in our STRDS with different granularities. Note that this module also has the option <tt>where</tt> that allows us to set specific dates for the aggregation. We will use this module to get 3-month and 6-month average LST.</p>
    <pre>
        <code class="neutral">
t.rast.aggregate input=LST_Day_monthly_celsius output=LST_Day_mean_3month basename=LST_Day_mean_3month suffix=gran method=average granularity="3 months"
t.info LST_Day_mean_3month
t.rast.list LST_Day_mean_3month

t.rast.aggregate input=LST_Day_monthly_celsius output=LST_Day_mean_6month basename=LST_Day_mean_6month suffix=gran method=average granularity="6 months"
t.info LST_Day_mean_6month
t.rast.list LST_Day_mean_6month
        </code>
        <code class="bash">
# 3-month mean LST
t.rast.aggregate input=LST_Day_monthly_celsius \
 output=LST_Day_mean_3month \
 basename=LST_Day_mean_3month suffix=gran \
 method=average granularity="3 months"

# Print info
t.info LST_Day_mean_3month

# Print list of maps
t.rast.list LST_Day_mean_3month

# 6-month mean LST
t.rast.aggregate input=LST_Day_monthly_celsius \
 output=LST_Day_mean_6month \
 basename=LST_Day_mean_6month suffix=gran \
 method=average granularity="6 months"

# Print info
t.info LST_Day_mean_6month

# Print list of maps
t.rast.list LST_Day_mean_6month
        </code>
        <code class="python">
# 3-month mean LST
gmod.Module("t.rast.aggregate", input="LST_Day_monthly_celsius", output="LST_Day_mean_3month",
            basename="LST_Day_mean_3month", suffix="gran", method="average", granularity="3 months")

# Get and print info about LST_Day_mean_3month strds in shell output format
dataset = tgis.dataset_factory("strds", "LST_Day_mean_3month@modis_lst")
dataset.select(dbif)
dataset.print_shell_info()

# Print list of maps
tgis.list_maps_of_stds("strds", "LST_Day_mean_3month@modis_lst", "name,mapset,start_time,end_time",
                       "start_time", "", "|", "cols", True, "no")
# 6-month mean LST
gmod.Module("t.rast.aggregate", input="LST_Day_monthly_celsius", output="LST_Day_mean_6month",
            basename="LST_Day_mean_6month", suffix="gran", method="average", granularity="6 months")

# Get and print info about LST_Day_mean_6month strds
gmod.Module("t.info", input="LST_Day_mean_6month")

# Print list of maps
gmod.Module("t.rast.list", input="LST_Day_mean_6month")
        </code>
    </pre>
    <p>Now, we will extract the 3-month average LST for points in a vector map. We will use the vector map <tt>points_of_interest</tt> that is already available in the PERMANENT mapset of NC Location. There are different commands that allow us to perform this task, but we'll use <a href="https://grass.osgeo.org/grass72/manuals/t.rast.what.html" target="_blank">t.rast.what</a>. This module samples a STRDS at specific vector point coordinates and writes the output to stdout using different layouts. You might explore the options available in the parameter <tt>layout</tt> to see the different ways to write the output.</p>
    <pre>
        <code class="neutral">
t.rast.what points=points_of_interest strds=LST_Day_mean_6month output=trastwhat_output.csv null_value=NA separator=comma
        </code>
        <code class="bash">
t.rast.what points=points_of_interest strds=LST_Day_mean_6month output=trastwhat_output.csv \
 null_value=NA separator=comma
        </code>
        <code class="python">
gmod.Module("t.rast.what", points="points_of_interest", strds="LST_Day_mean_6month",
            output="trastwhat_output.csv", null_value="NA", separator="comma")
        </code>
    </pre>
    <p>Even though the most common is to extract raster data to points, we may also be interested in getting spatially aggregated time series data for polygons. GRASS GIS has an add-on for this: <a href="https://grass.osgeo.org/grass72/manuals/addons/v.strds.stats.html" target="_blank">v.strds.stats</a>. It calculates zonal statistics of each raster in a STRDS and writes the output to the attribute table of a new polygon vector map. We first need to install the add-on through <a href="https://grass.osgeo.org/grass72/manuals/g.extension.html">g.extension</a>. Then, we will extract the average, minimum and maximum monthly LST for the different geologic types in NC.</p>
    <pre>
        <code class="neutral">
g.extension v.strds.stats
v.strds.stats input=geology strds=LST_Day_monthly_celsius output=geology_aggr_lst method=average,minimum,maximum
v.db.select map=geology_aggr_lst file=ts_polygons.csv
        </code>
        <code class="bash">
# Install v.strds.stats add-on
g.extension v.strds.stats

# Extract mean, max and min LST for municipalities
v.strds.stats input=geology strds=LST_Day_monthly_celsius \
 output=geology_aggr_lst method=average,minimum,maximum

# Save the attribute table of the new vector into a csv file
v.db.select map=geology_aggr_lst file=ts_polygons.csv
        </code>
        <code class="python">
# Install v.strds.stats add-on
gmod.Module("g.extension", extension="v.strds.stats")

# Extract mean, max and min LST for municipalities
gmod.Module("v.strds.stats", input="geology", output="geology_aggr_lst",
            strds="LST_Day_monthly_celsius", method="average,minimum,maximum")

# Save the attribute table of the new vector into a csv file
gmod.Module("v.db.select", map="geology_aggr_lst", file="ts_polygons.csv")
        </code>
    </pre>
    </p>
    <h3>Temporal data visualization</h3>
    <p>Aside from g.gui.timeline that we saw before, GRASS GIS offers different options to visualize time series data. The first one is <a href="https://grass.osgeo.org/grass72/manuals/g.gui.mapswipe.html" target="_blank">g.gui.mapswipe</a> that allows us to compare two maps from different dates for example by swiping a visibility bar. The module can be called from command line by specifying the two maps to compare or executed from the GUI as shown below in the respective tabs.</p>
    <pre>
        <code class="neutral">
g.gui.mapswipe first=LST_Day_monthly_celsius_6 second=LST_Day_monthly_celsius_12
        </code>
        <code class="gui">
1. Select first and second map from the dropdown map lists.
2. Swipe as desired. Optionally you can change the swipe orientation or switch maps with the tools button.
3. Change to "Mirror mode" to see the exact same position in both maps.
    <div class="imagebox">
        <img style="width: 55%;" src="figures/g_gui_mapswipe_1.png" alt="g.gui.mapswipe first" title="g.gui.mapswipe first step"><br>
        <img style="width: 60%;" src="figures/g_gui_mapswipe_2.png" alt="g.gui.mapswipe second" title="g.gui.mapswipe second step"><br>
        <img style="width: 60%;" src="figures/g_gui_mapswipe_3.png" alt="g.gui.mapswipe third" title="g.gui.mapswipe third step"><br>
    </div>
		</code>
    </pre>
    <p>Another tool to visualize time series in more dynamic way and that allows us to see changes in space an time simultaneously is <a href="https://grass.osgeo.org/grass72/manuals/g.gui.animation.html" target="_blank">g.gui.animation</a>. It also allows to animate vector time series, as well as lists of raster or vector maps not specifically registered as time series. When executed from command line, options are more limited than when the module is run from the GUI, where it is possible to add different decorations and customize several options.</p>
    <pre>
        <code class="neutral">
g.gui.animation strds=LST_Day_monthly_celsius@modis_lst
        </code>
        <code class="gui">
1. Add a new animation (you can add up to 4 animations).
2, 3, 4. Add a space time data set (vector or raster) or list of raster or vector maps.
5. Optionally, add vector maps such as boundaries, points of interest, etc.
6. Once you finished adding maps and customizing their display, click OK.
7. Play the animation (note that you can move forwards or backwards, pause, stop, change velocity).
8. Export the animation.
9. Add decorations such as text, time stamp, images, if desired.
10. Select folder and file name (Note that this step slightly varies according to the output format desired).
11. Click Export.
    <div class="imagebox">
        <img style="width: 60%;" src="figures/g_gui_animation_1.png" alt="g.gui.animation first" title="g.gui.animation first step"><br>
        <img style="width: 60%;" src="figures/g_gui_animation_2.png" alt="g.gui.animation second" title="g.gui.animation second step"><br>
        <img style="width: 60%;" src="figures/g_gui_animation_3.png" alt="g.gui.animation third" title="g.gui.animation third step"><br>
        <img style="width: 60%;" src="figures/g_gui_animation_4.png" alt="g.gui.animation fourth" title="g.gui.animation fourth step"><br>
    </div>
		</code>
    </pre>
    <p>Finally, if you want to plot the time series of our variable of interest, be it in a STRDS or a STVDS, for a specific point of your study region, GRASS GIS has <a href="https://grass.osgeo.org/grass72/manuals/g.gui.tplot.html" target="_blank">g.gui.tplot</a>. Basically, you need to set the strds or stvds and a pair of X,Y coordinates. The latter can be typed directly, copied from the map display and pasted or directly chosen from the display. See instructions below.</p>
    <pre>
        <code class="neutral">
g.gui.tplot strds=LST_Day_monthly_celsius@modis_lst coordinates=419604.018913,215736.80063
        </code>
        <code class="gui">
1. Select the STRDS.
2. Type coordinates or select a point in the display (use the arrow at the end of the second line).
3. Click Draw.
4. Inspect values for specific dates.

Alternatively, you can adjust the margin settings, zoom in to different parts of the plots and save it.
    <div class="imagebox">
        <img style="width: 50%;" src="figures/g_gui_tplot_1.png" alt="g.gui.tplot first" title="g.gui.tplot first step"><br>
        <img style="width: 60%;" src="figures/g_gui_tplot_2.png" alt="g.gui.tplot second" title="g.gui.tplot second step"><br>
        <img style="width: 60%;" src="figures/g_gui_tplot_3.png" alt="g.gui.tplot third" title="g.gui.tplot third step"><br>
        <img style="width: 40%;" src="figures/g_gui_tplot_4.png" alt="g.gui.tplot fourth" title="g.gui.tplot fourth step"><br>
    </div>
		</code>
-->
    </pre>
    <h2>Other (very) useful links</h2>
    <ul>
        <li>GRASS intro workshop: <a href="https://ncsu-osgeorel.github.io/grass-intro-workshop/" target="_blank">https://ncsu-osgeorel.github.io/grass-intro-workshop/</a></li>
        <li>Unleash the power of GRASS GIS: <a href="https://grasswiki.osgeo.org/wiki/Unleash_the_power_of_GRASS_GIS_at_US-IALE_2017" target="_blank">https://grasswiki.osgeo.org/wiki/Unleash_the_power_of_GRASS_GIS_at_US-IALE_2017</a></li>
        <li>Temporal data processing wiki: <a href="https://grasswiki.osgeo.org/wiki/Temporal_data_processing" target="_blank">https://grasswiki.osgeo.org/wiki/Temporal_data_processing</a></li>
        <li>GRASS GIS temporal workshop: <a href="http://ncsu-geoforall-lab.github.io/grass-temporal-workshop/" target="_blank">http://ncsu-geoforall-lab.github.io/grass-temporal-workshop/</a></li>
        <li>GRASS GIS and R for time series processing: <a href="https://grasswiki.osgeo.org/wiki/Temporal_data_processing/GRASS_R_raster_time_series_processing" target="_blank">https://grasswiki.osgeo.org/wiki/Temporal_data_processing/GRASS_R_raster_time_series_processing</a></li>
    </ul>
    <h2>References</h2>
    <ul>
        <li>Gebbert, S., Pebesma, E. (2014). <em>A temporal GIS for field based environmental modeling</em>. Environmental Modelling & Software, 53, 112. <a href="https://doi.org/10.1016/j.envsoft.2013.11.001" target="_blank">DOI</a></li>
        <li>Gebbert, S., Pebesma, E. (2017). <em>The GRASS GIS temporal framework</em>. International Journal of Geographical Information Science 31, 1273-1292. <a href="http://dx.doi.org/10.1080/13658816.2017.1306862" target="_blank">DOI</a></li>
        <li>Neteler, M., Bowman, M.H., Landa, M. and Metz, M. (2012): <em>GRASS GIS: a multi-purpose Open Source GIS</em>. Environmental Modelling & Software, 31: 124-130 <a href="http://dx.doi.org/10.1016/j.envsoft.2011.11.014" target="_blank">DOI</a></li>
        <li>Neteler, M., Mitasova, H. (2008): <em>Open Source GIS: A GRASS GIS Approach</em>. Third edition. ed. Springer, New York. <a href="https://grassbook.org/" target="_blank">Book site</a></li>
    </ul>
    </p>
    <hr>
    <p><i>Last changed: 2017-07-17 20:17</i></p>
    <p>
    <a href="http://grass.osgeo.org/grass72/manuals/">GRASS GIS manual main index</a> |
    <a href="http://grass.osgeo.org/grass72/manuals/temporal.html">Temporal modules index</a> |
    <a href="http://grass.osgeo.org/grass72/manuals/topics.html">Topics index</a> |
    <a href="http://grass.osgeo.org/grass72/manuals/keywords.html">Keywords Index</a> |
    <a href="http://grass.osgeo.org/grass72/manuals/full_index.html">Full index</a>
    </p>
    <p>
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" src="ccbysa.png"></a>
    <br>
    TGRASS: temporal data processing with GRASS GIS Workshop at FOSS4G Europe 2017 by Veronica Andreo, Luca Delucchi and Markus Neteler is licensed under a <b><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a></b> - Thanks to <a href="http://www4.ncsu.edu/~vpetras/index.html" target="_blank"><b>Vaclav Petras</b></a> for the style.
    </p>
  </div>

</body>
</html>
